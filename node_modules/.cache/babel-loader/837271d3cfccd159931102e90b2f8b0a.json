{"ast":null,"code":"import{useEffect}from'react';import{useDispatch,useSelector}from'../services/hooks';import styles from'./pages.module.css';import{wsConnectionClosedAction,wsConnectionStartAction}from'../services/actions/feed';import{formatRelative}from'date-fns';import{ru}from'date-fns/locale';import{useParams,useLocation}from'react-router-dom';import{formatStatus}from'../services/utils';import{CurrencyIcon}from'@ya.praktikum/react-developer-burger-ui-components';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var OrderPage=function OrderPage(){var _orders$orders;var _useParams=useParams(),id=_useParams.id;var location=useLocation();console.log(location.pathname.split('/')[1]);var orders=useSelector(function(state){return state.feed.orders;});var order=orders===null||orders===void 0?void 0:(_orders$orders=orders.orders)===null||_orders$orders===void 0?void 0:_orders$orders.find(function(item){return item._id===id;});var ingredients=useSelector(function(store){return store.burger.ingredients;});var payload=location.pathname.split('/')[1]=='feed'?'/all':'';var orderIngredients=ingredients===null||ingredients===void 0?void 0:ingredients.filter(function(ingredient){return order===null||order===void 0?void 0:order.ingredients.includes(ingredient._id);});var totalPrice=orderIngredients.reduce(function(total,cur){var sumIngredients=cur.type=='bun'?cur.price:cur.price*2;total+=sumIngredients;return total;},0);var dispatch=useDispatch();useEffect(function(){dispatch(wsConnectionStartAction(location.pathname.split('/')[1]=='feed'?false:true,payload));return function(){dispatch(wsConnectionClosedAction());};},[dispatch]);if(!order)return/*#__PURE__*/_jsx(\"main\",{className:styles.modal,children:/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-medium mt-30\",children:\" \\u041F\\u043E\\u0434\\u043E\\u0436\\u0434\\u0438\\u0442\\u0435, \\u0438\\u0434\\u0435\\u0442 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"})});return/*#__PURE__*/_jsxs(\"main\",{className:styles.modal,children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_digits-default \",children:[\"#\",order===null||order===void 0?void 0:order.number]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.content,children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_main-medium mt-10\",children:[\" \",order===null||order===void 0?void 0:order.name]}),/*#__PURE__*/_jsx(\"p\",{className:styles.status,children:formatStatus((order===null||order===void 0?void 0:order.status)||'')}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-medium mt-6 mb-3\",children:\"\\u0421\\u043E\\u0441\\u0442\\u0430\\u0432:\"}),orderIngredients===null||orderIngredients===void 0?void 0:orderIngredients.map(function(item,index){return/*#__PURE__*/_jsxs(\"div\",{className:styles.ingredients,children:[/*#__PURE__*/_jsx(\"img\",{className:styles.image,src:item===null||item===void 0?void 0:item.image_mobile}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-default\",children:item===null||item===void 0?void 0:item.name}),/*#__PURE__*/_jsxs(\"div\",{className:styles.total,children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_digits-default mr-2\",children:[item.type==='bun'?2:1,\" x \",item===null||item===void 0?void 0:item.price]}),/*#__PURE__*/_jsx(CurrencyIcon,{type:\"primary\"})]})]},index);}),/*#__PURE__*/_jsxs(\"div\",{className:styles.row,children:[/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-default text_color_inactive \",children:order?formatRelative(new Date(order.createdAt),new Date(),{locale:ru}):''}),/*#__PURE__*/_jsxs(\"div\",{className:styles.total,children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_digits-default mr-2 \",children:[\" \",totalPrice]}),/*#__PURE__*/_jsx(CurrencyIcon,{type:\"primary\"})]})]})]})]});};export default OrderPage;","map":{"version":3,"sources":["/Users/annaplokhotnyuk/Documents/react-burger/src/pages/order.tsx"],"names":["useEffect","useDispatch","useSelector","styles","wsConnectionClosedAction","wsConnectionStartAction","formatRelative","ru","useParams","useLocation","formatStatus","CurrencyIcon","OrderPage","id","location","console","log","pathname","split","orders","state","feed","order","find","item","_id","ingredients","store","burger","payload","orderIngredients","filter","ingredient","includes","totalPrice","reduce","total","cur","sumIngredients","type","price","dispatch","modal","number","content","name","status","map","index","image","image_mobile","row","Date","createdAt","locale"],"mappings":"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","sourcesContent":["import { useEffect } from 'react';\nimport { useDispatch, useSelector } from '../services/hooks';\nimport styles from './pages.module.css';\nimport {\n  wsConnectionClosedAction,\n  wsConnectionStartAction,\n} from '../services/actions/feed';\nimport { formatRelative } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport { TIngredient } from '../utils/types';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { formatStatus } from '../services/utils'\nimport { CurrencyIcon } from '@ya.praktikum/react-developer-burger-ui-components';\n\nconst OrderPage: React.FC = () => {\n  const { id } = useParams<{ id?: string }>();\n  const location = useLocation();\n  console.log(location.pathname.split('/')[1])\n  const orders = useSelector((state) => state.feed.orders);\n  const order = orders?.orders?.find((item) => item._id === id);\n  const ingredients = useSelector((store) => store.burger.ingredients);\n  const payload = location.pathname.split('/')[1]=='feed'? '/all' : ''\n  const orderIngredients = ingredients?.filter((ingredient: TIngredient) => order?.ingredients.includes(ingredient._id));\n\n  const totalPrice = orderIngredients.reduce((total: number, cur: TIngredient) => {\n    const sumIngredients = cur.type == 'bun' ? cur.price : cur.price * 2;\n    total += sumIngredients;\n    return total;\n  }, 0);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(wsConnectionStartAction( location.pathname.split('/')[1]=='feed'? false : true, payload));\n\n    return () => {\n      dispatch(wsConnectionClosedAction());\n    };\n  }, [dispatch]);\n\n  if (!order)\n  return (\n    <main className={styles.modal} >\n    <p className=\"text text_type_main-medium mt-30\"> Подождите, идет загрузка...</p>\n    </main>\n  )\n\n  return (\n    <main className={styles.modal} >\n      <p className=\"text text_type_digits-default \">#{order?.number}</p>\n      <div className={styles.content}>\n        <p className=\"text text_type_main-medium mt-10\"> {order?.name}</p>\n        <p className={styles.status}>{formatStatus(order?.status||'')}</p>\n        <p className=\"text text_type_main-medium mt-6 mb-3\">\n          Состав:\n        </p>\n        {orderIngredients?.map((item: TIngredient, index: number) => (\n          <div className={styles.ingredients} key={index}>\n            <img className={styles.image} src={item?.image_mobile} />\n            <p className=\"text text_type_main-default\">{item?.name}</p>\n            <div className={styles.total}>\n              <p className=\"text text_type_digits-default mr-2\">\n                {item.type === 'bun' ? 2 : 1} x {item?.price}\n              </p>\n              <CurrencyIcon type=\"primary\" />\n            </div>\n          </div>\n        ))}\n        <div className={styles.row}>\n          <p className=\"text text_type_main-default text_color_inactive \">{order ? formatRelative(new Date(order.createdAt), new Date(), {\n    locale: ru,\n  }) : ''}</p>\n          <div className={styles.total}>\n            <p className=\"text text_type_digits-default mr-2 \"> {totalPrice}</p>\n            <CurrencyIcon type=\"primary\" />\n          </div>\n        </div>\n      </div>\n    </main>\n  )\n}\n\nexport default OrderPage;\n\n"]},"metadata":{},"sourceType":"module"}