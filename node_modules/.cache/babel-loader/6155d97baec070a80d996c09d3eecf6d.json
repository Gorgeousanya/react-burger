{"ast":null,"code":"import _objectSpread from\"/Users/annaplokhotnyuk/Documents/react-burger/react-burger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/annaplokhotnyuk/Documents/react-burger/react-burger/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{v4 as uuidv4}from\"uuid\";import constructorStyles from'./burger-constructor.module.css';import{Button,DragIcon,ConstructorElement,CurrencyIcon}from'@ya.praktikum/react-developer-burger-ui-components';import{Modal}from'../modal/modal';import OrderDetails from'../order-details/order-details';import{useDrag,useDrop}from\"react-dnd\";import{useSelector,useDispatch}from'react-redux';import{getOrderID,deleteIngredient,addIngredient,changeSortIngredient,resetOrder,closeModalOrder,openModalOrder}from'../../services/actions/burger';import{useHistory}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Constructor=function Constructor(_ref){var item=_ref.item,index=_ref.index;var ref=React.useRef(null);var dispatch=useDispatch();var _useDrag=useDrag({type:\"ingredient\",item:{index:index}}),_useDrag2=_slicedToArray(_useDrag,2),dragRef=_useDrag2[1];var _useDrop=useDrop({accept:\"ingredient\",hover:function hover(item){if(!ref.current)return;var dragIndex=item.index;var hoverIndex=index;if(dragIndex===hoverIndex)return;dispatch(changeSortIngredient(dragIndex,hoverIndex));item.index=hoverIndex;}}),_useDrop2=_slicedToArray(_useDrop,2),dropTarget=_useDrop2[1];var onClose=function onClose(){dispatch(deleteIngredient(item===null||item===void 0?void 0:item.uuid));};dragRef(dropTarget(ref));return/*#__PURE__*/_jsxs(\"div\",{className:constructorStyles.element,ref:ref,children:[/*#__PURE__*/_jsx(DragIcon,{type:\"primary\"}),/*#__PURE__*/_jsx(ConstructorElement,{text:item===null||item===void 0?void 0:item.name,price:item===null||item===void 0?void 0:item.price,thumbnail:item===null||item===void 0?void 0:item.image,handleClose:onClose})]});};var BurgerConstructor=function BurgerConstructor(){var dispatch=useDispatch();var constructor=useSelector(function(state){var _state$burger$constru;return(_state$burger$constru=state.burger.constructor)!==null&&_state$burger$constru!==void 0?_state$burger$constru:[];});var bun=constructor.find(function(ingredient){return(ingredient===null||ingredient===void 0?void 0:ingredient.type)==='bun';});var other=constructor.filter(function(ingredient){return(ingredient===null||ingredient===void 0?void 0:ingredient.type)&&(ingredient===null||ingredient===void 0?void 0:ingredient.type)!=='bun';});var open=useSelector(function(state){return state.burger.modalOrder;});var history=useHistory();var loggedIn=useSelector(function(store){return store.auth.loggedIn;});var total=React.useMemo(function(){return constructor?constructor.filter(function(ingredient){return ingredient===null||ingredient===void 0?void 0:ingredient.price;}).reduce(function(sum,current){return sum+current.price;},0):0;},[constructor]);var _useDrop3=useDrop({accept:\"ingredients\",drop:function drop(ingredient){if(bun&&ingredient.type===\"bun\"){dispatch(deleteIngredient(bun===null||bun===void 0?void 0:bun.uuid));}dispatch(addIngredient(_objectSpread(_objectSpread({},ingredient),{},{uuid:uuidv4()})));},collect:function collect(monitor){return{isDrop:monitor.isOver()};}}),_useDrop4=_slicedToArray(_useDrop3,2),isDrop=_useDrop4[0].isDrop,dropTarget=_useDrop4[1];var clickOrder=function clickOrder(){if(loggedIn){var data=constructor.map(function(item){return item._id;});dispatch(getOrderID(data));setTimeout(function(){dispatch(openModalOrder());},1000);}else{history.push(\"/login\");}};var onClose=function onClose(){dispatch(closeModalOrder());dispatch(resetOrder());};var classNameContainer=\"\".concat(constructorStyles.container,\" \").concat(isDrop&&constructorStyles.drop);return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(Modal,{isOpen:open,onClose:onClose,children:[\" \",/*#__PURE__*/_jsx(OrderDetails,{})]}),/*#__PURE__*/_jsxs(\"div\",{className:classNameContainer,ref:dropTarget,children:[bun?/*#__PURE__*/_jsx(ConstructorElement,{type:\"top\",isLocked:true,text:\"\".concat(bun.name,\" (\\u0432\\u0435\\u0440\\u0445)\"),price:bun.price,thumbnail:bun.image}):/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-medium\",children:\"\\u041F\\u0435\\u0440\\u0435\\u043D\\u0435\\u0441\\u0438\\u0442\\u0435 \\u0441\\u044E\\u0434\\u0430 \\u0438\\u043D\\u0433\\u0440\\u0435\\u0434\\u0438\\u0435\\u043D\\u0442\\u044B \\u0434\\u043B\\u044F \\u0431\\u0443\\u0440\\u0433\\u0435\\u0440\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:constructorStyles.main,children:other&&(other===null||other===void 0?void 0:other.map(function(item,i){return/*#__PURE__*/_jsx(Constructor,{item:item,index:i},item===null||item===void 0?void 0:item.uuid);}))}),bun&&/*#__PURE__*/_jsx(ConstructorElement,{type:\"bottom\",isLocked:true,text:\"\".concat(bun.name,\" (\\u043D\\u0438\\u0437)\"),price:bun.price,thumbnail:bun.image}),/*#__PURE__*/_jsxs(\"div\",{className:constructorStyles.cost,children:[/*#__PURE__*/_jsx(\"div\",{className:constructorStyles.price,children:/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_digits-medium\",children:[total,/*#__PURE__*/_jsx(CurrencyIcon,{type:\"primary\"})]})}),/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"large\",onClick:clickOrder,disabled:total===0,children:\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u044C \\u0437\\u0430\\u043A\\u0430\\u0437\"})]})]})]});};export default BurgerConstructor;","map":{"version":3,"sources":["/Users/annaplokhotnyuk/Documents/react-burger/react-burger/src/components/burger-constructor/burger-constructor.tsx"],"names":["React","v4","uuidv4","constructorStyles","Button","DragIcon","ConstructorElement","CurrencyIcon","Modal","OrderDetails","useDrag","useDrop","useSelector","useDispatch","getOrderID","deleteIngredient","addIngredient","changeSortIngredient","resetOrder","closeModalOrder","openModalOrder","useHistory","Constructor","item","index","ref","useRef","dispatch","type","dragRef","accept","hover","current","dragIndex","hoverIndex","dropTarget","onClose","uuid","element","name","price","image","BurgerConstructor","constructor","state","burger","bun","find","ingredient","other","filter","open","modalOrder","history","loggedIn","store","auth","total","useMemo","reduce","sum","drop","collect","monitor","isDrop","isOver","clickOrder","data","map","_id","setTimeout","push","classNameContainer","container","main","i","cost"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { v4 as uuidv4 } from \"uuid\"\nimport constructorStyles from './burger-constructor.module.css';\nimport { Button, DragIcon, ConstructorElement, CurrencyIcon } from '@ya.praktikum/react-developer-burger-ui-components';\nimport {Modal} from '../modal/modal';\nimport OrderDetails from '../order-details/order-details';\nimport { TIngredient } from '../../utils/types';\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { RootStateOrAny, useSelector, useDispatch } from 'react-redux';\nimport { getOrderID, deleteIngredient, addIngredient, changeSortIngredient, resetOrder, closeModalOrder, openModalOrder } from '../../services/actions/burger';\nimport { useHistory } from 'react-router-dom';\n\n\nconst Constructor: React.FC<TConstructor> = ({ item, index }) => {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const dispatch = useDispatch();\n  const [, dragRef] = useDrag({\n    type: \"ingredient\",\n    item: { index }\n  });\n\n  const [, dropTarget] = useDrop({\n    accept: \"ingredient\",\n    hover: (item: any) => {\n      if (!ref.current) return;\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      if (dragIndex === hoverIndex) return;\n      dispatch(changeSortIngredient(dragIndex, hoverIndex))\n      item.index = hoverIndex;\n    }\n  });\n\n  const onClose = () => {\n    dispatch(deleteIngredient(item?.uuid));\n  }\n\n  dragRef(dropTarget(ref));\n\n  return (\n    <div className={constructorStyles.element} ref={ref} >\n      <DragIcon type=\"primary\" />\n      <ConstructorElement\n        text={item?.name}\n        price={item?.price}\n        thumbnail={item?.image}\n        handleClose={onClose}\n      />\n    </div>\n  )\n}\n\nconst BurgerConstructor = () => {\n  const dispatch = useDispatch();\n  const constructor = useSelector((state: RootStateOrAny) => state.burger.constructor ?? []);\n  const bun = constructor.find((ingredient: any) => ingredient?.type === 'bun');\n  const other = constructor.filter((ingredient: any) => ingredient?.type && ingredient?.type !== 'bun');\n  const open = useSelector((state: RootStateOrAny) => state.burger.modalOrder);\n  const history = useHistory();\n  const loggedIn = useSelector((store: RootStateOrAny) => store.auth.loggedIn);\n  \n  const total: number = React.useMemo(\n    () =>\n      constructor\n        ? constructor.filter((ingredient: any) => ingredient?.price).reduce((sum: any, current: any) => sum + current.price, 0)\n        : 0,\n    [constructor]\n  );\n\n  const [{ isDrop }, dropTarget] = useDrop({\n    accept: \"ingredients\",\n    drop: (ingredient: any) => {\n      if (bun && ingredient.type === \"bun\") {\n        dispatch(deleteIngredient(bun?.uuid));\n      }\n      dispatch(addIngredient({ ...ingredient, uuid: uuidv4() }))\n    },\n    collect: (monitor) => ({\n      isDrop: monitor.isOver(),\n    }),\n  });\n\n  const clickOrder = () => {\n    if (loggedIn) {\n      const data = constructor.map(((item: any) => item._id));\n      dispatch(getOrderID(data));\n      setTimeout(() => {\n        dispatch(openModalOrder())\n      }, 1000)\n    } else {\n      history.push(\"/login\");\n    }\n  }\n\n  const onClose = () => {\n    dispatch(closeModalOrder()); \n    dispatch(resetOrder());\n  }\n\n  const classNameContainer = `${constructorStyles.container} ${isDrop && constructorStyles.drop}`\n\n  return (\n    <React.Fragment>\n      <Modal\n        isOpen={open}\n        onClose={onClose}\n      > <OrderDetails />\n      </Modal>\n      <div className={classNameContainer} ref={dropTarget}>\n        {\n          bun\n            ? <ConstructorElement\n              type=\"top\"\n              isLocked={true}\n              text={`${bun.name} (верх)`}\n              price={bun.price}\n              thumbnail={bun.image}\n            />\n            : <p className=\"text text_type_main-medium\" >\n              Перенесите сюда ингредиенты для бургера\n            </p>\n        }\n        <div className={constructorStyles.main}>\n          {other &&\n            other?.map((item: any, i: any) =>\n              (<Constructor key={item?.uuid} item={item} index={i} />))\n          }\n        </div>\n        {\n          bun\n          && <ConstructorElement\n            type=\"bottom\"\n            isLocked={true}\n            text={`${bun.name} (низ)`}\n            price={bun.price}\n            thumbnail={bun.image}\n          />\n        }\n        <div className={constructorStyles.cost}>\n          <div className={constructorStyles.price}>\n            <p className=\"text text_type_digits-medium\" >\n              {total}\n              <CurrencyIcon type=\"primary\" />\n            </p>\n          </div>\n          <Button type=\"primary\" size=\"large\" onClick={clickOrder} disabled={total === 0}>\n            Оформить заказ\n          </Button>\n        </div>\n      </div>\n    </React.Fragment>\n  )\n}\n\n\ntype TConstructor = {\n  item: TIngredient,\n  index: number,\n}\n\nexport default BurgerConstructor;"]},"metadata":{},"sourceType":"module"}