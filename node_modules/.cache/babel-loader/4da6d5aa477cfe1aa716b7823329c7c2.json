{"ast":null,"code":"var _jsxFileName = \"/Users/annaplokhotnyuk/Documents/react-burger/src/components/burger-constructor/burger-constructor.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from 'react';\nimport { v4 as uuidv4 } from \"uuid\";\nimport constructorStyles from './burger-constructor.module.css';\nimport { Button, DragIcon, ConstructorElement, CurrencyIcon } from '@ya.praktikum/react-developer-burger-ui-components';\nimport { Modal } from '../modal/modal';\nimport OrderDetails from '../order-details/order-details';\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { useDispatch, useSelector } from '../../services/hooks';\nimport { getOrderID, deleteIngredient, addIngredient, changeSortIngredient, resetOrder, closeModalOrder, openModalOrder } from '../../services/actions/burger';\nimport { useHistory } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Constructor = _ref => {\n  _s();\n\n  let {\n    item,\n    index\n  } = _ref;\n  const ref = React.useRef(null);\n  const dispatch = useDispatch();\n  const [, dragRef] = useDrag({\n    type: \"ingredient\",\n    item: {\n      index\n    }\n  });\n  const [, dropTarget] = useDrop({\n    accept: \"ingredient\",\n    hover: item => {\n      if (!ref.current) return;\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      if (dragIndex === hoverIndex) return;\n      dispatch(changeSortIngredient(dragIndex, hoverIndex));\n      item.index = hoverIndex;\n    }\n  });\n\n  const onClose = () => {\n    dispatch(deleteIngredient(item === null || item === void 0 ? void 0 : item.uuid));\n  };\n\n  dragRef(dropTarget(ref));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: constructorStyles.element,\n    ref: ref,\n    children: [/*#__PURE__*/_jsxDEV(DragIcon, {\n      type: \"primary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ConstructorElement, {\n      text: item === null || item === void 0 ? void 0 : item.name,\n      price: item === null || item === void 0 ? void 0 : item.price,\n      thumbnail: item === null || item === void 0 ? void 0 : item.image,\n      handleClose: onClose\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 41,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Constructor, \"PfT4XolOGN3UFionx/8usuLWjlE=\", false, function () {\n  return [useDispatch, useDrag, useDrop];\n});\n\n_c = Constructor;\n\nconst BurgerConstructor = () => {\n  _s2();\n\n  const dispatch = useDispatch();\n  const constructor = useSelector(store => {\n    var _store$burger$constru;\n\n    return (_store$burger$constru = store.burger.constructor) !== null && _store$burger$constru !== void 0 ? _store$burger$constru : [];\n  });\n  const bun = constructor.find(ingredient => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) === 'bun');\n  const other = constructor.filter(ingredient => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) && (ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) !== 'bun');\n  const open = useSelector(store => store.burger.modalOrder);\n  const history = useHistory();\n  const loggedIn = useSelector(store => store.auth.loggedIn);\n  const total = React.useMemo(() => constructor ? constructor.filter(ingredient => ingredient === null || ingredient === void 0 ? void 0 : ingredient.price).reduce((sum, current) => sum + current.price, 0) : 0, [constructor]);\n  const [{\n    isDrop\n  }, dropTarget] = useDrop({\n    accept: \"ingredients\",\n    drop: ingredient => {\n      if (bun && ingredient.type === \"bun\") {\n        dispatch(deleteIngredient(bun === null || bun === void 0 ? void 0 : bun.uuid));\n      }\n\n      dispatch(addIngredient({ ...ingredient,\n        uuid: uuidv4()\n      }));\n    },\n    collect: monitor => ({\n      isDrop: monitor.isOver()\n    })\n  });\n\n  const clickOrder = () => {\n    if (loggedIn) {\n      const data = constructor.map(item => item._id);\n      console.log(data);\n      dispatch(getOrderID(data));\n      setTimeout(() => {\n        dispatch(openModalOrder());\n      }, 1000);\n    } else {\n      history.push(\"/login\");\n    }\n  };\n\n  const onClose = () => {\n    dispatch(closeModalOrder());\n    console.log(open);\n    dispatch(resetOrder());\n  };\n\n  const classNameContainer = `${constructorStyles.container} ${isDrop && constructorStyles.drop}`;\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: open,\n      onClose: onClose,\n      children: [\" \", /*#__PURE__*/_jsxDEV(OrderDetails, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classNameContainer,\n      ref: dropTarget,\n      children: [bun ? /*#__PURE__*/_jsxDEV(ConstructorElement, {\n        type: \"top\",\n        isLocked: true,\n        text: `${bun.name} (верх)`,\n        price: bun.price,\n        thumbnail: bun.image\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 15\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text text_type_main-medium\",\n        children: \"\\u041F\\u0435\\u0440\\u0435\\u043D\\u0435\\u0441\\u0438\\u0442\\u0435 \\u0441\\u044E\\u0434\\u0430 \\u0438\\u043D\\u0433\\u0440\\u0435\\u0434\\u0438\\u0435\\u043D\\u0442\\u044B \\u0434\\u043B\\u044F \\u0431\\u0443\\u0440\\u0433\\u0435\\u0440\\u0430\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: constructorStyles.main,\n        children: other && (other === null || other === void 0 ? void 0 : other.map((item, i) => /*#__PURE__*/_jsxDEV(Constructor, {\n          item: item,\n          index: i\n        }, item === null || item === void 0 ? void 0 : item.uuid, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 16\n        }, this)))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), bun && /*#__PURE__*/_jsxDEV(ConstructorElement, {\n        type: \"bottom\",\n        isLocked: true,\n        text: `${bun.name} (низ)`,\n        price: bun.price,\n        thumbnail: bun.image\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 14\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: constructorStyles.cost,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: constructorStyles.price,\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text text_type_digits-medium\",\n            children: [total, /*#__PURE__*/_jsxDEV(CurrencyIcon, {\n              type: \"primary\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          size: \"large\",\n          onClick: clickOrder,\n          disabled: total === 0,\n          children: \"\\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u044C \\u0437\\u0430\\u043A\\u0430\\u0437\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(BurgerConstructor, \"zSb3GaGHMpuqfDkmZumzgwUEo+M=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useHistory, useSelector, useDrop];\n});\n\n_c2 = BurgerConstructor;\nexport default BurgerConstructor;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Constructor\");\n$RefreshReg$(_c2, \"BurgerConstructor\");","map":{"version":3,"sources":["/Users/annaplokhotnyuk/Documents/react-burger/src/components/burger-constructor/burger-constructor.tsx"],"names":["React","v4","uuidv4","constructorStyles","Button","DragIcon","ConstructorElement","CurrencyIcon","Modal","OrderDetails","useDrag","useDrop","useDispatch","useSelector","getOrderID","deleteIngredient","addIngredient","changeSortIngredient","resetOrder","closeModalOrder","openModalOrder","useHistory","Constructor","item","index","ref","useRef","dispatch","dragRef","type","dropTarget","accept","hover","current","dragIndex","hoverIndex","onClose","uuid","element","name","price","image","BurgerConstructor","constructor","store","burger","bun","find","ingredient","other","filter","open","modalOrder","history","loggedIn","auth","total","useMemo","reduce","sum","isDrop","drop","collect","monitor","isOver","clickOrder","data","map","_id","console","log","setTimeout","push","classNameContainer","container","main","i","cost"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { v4 as uuidv4 } from \"uuid\"\nimport constructorStyles from './burger-constructor.module.css';\nimport { Button, DragIcon, ConstructorElement, CurrencyIcon } from '@ya.praktikum/react-developer-burger-ui-components';\nimport {Modal} from '../modal/modal';\nimport OrderDetails from '../order-details/order-details';\nimport { TIngredient } from '../../utils/types';\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { useDispatch, useSelector } from '../../services/hooks';\nimport { getOrderID, deleteIngredient, addIngredient, changeSortIngredient, resetOrder, closeModalOrder, openModalOrder } from '../../services/actions/burger';\nimport { useHistory } from 'react-router-dom';\n\n\nconst Constructor: React.FC<TConstructor> = ({ item, index }) => {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const dispatch = useDispatch();\n  const [, dragRef] = useDrag({\n    type: \"ingredient\",\n    item: { index }\n  });\n\n  const [, dropTarget] = useDrop({\n    accept: \"ingredient\",\n    hover: (item: any) => {\n      if (!ref.current) return;\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      if (dragIndex === hoverIndex) return;\n      dispatch(changeSortIngredient(dragIndex, hoverIndex))\n      item.index = hoverIndex;\n    }\n  });\n\n  const onClose = () => {\n    dispatch(deleteIngredient(item?.uuid));\n  }\n\n  dragRef(dropTarget(ref));\n\n  return (\n    <div className={constructorStyles.element} ref={ref} >\n      <DragIcon type=\"primary\" />\n      <ConstructorElement\n        text={item?.name}\n        price={item?.price}\n        thumbnail={item?.image}\n        handleClose={onClose}\n      />\n    </div>\n  )\n}\n\nconst BurgerConstructor = () => {\n  const dispatch = useDispatch();\n  const constructor = useSelector((store) => store.burger.constructor ?? []);\n  const bun = constructor.find((ingredient) => ingredient?.type === 'bun');\n  const other = constructor.filter((ingredient) => ingredient?.type && ingredient?.type !== 'bun');\n  const open = useSelector((store) => store.burger.modalOrder);\n  const history = useHistory();\n  const loggedIn = useSelector((store) => store.auth.loggedIn);\n  \n  const total: number = React.useMemo(\n    () =>\n      constructor\n        ? constructor.filter((ingredient) => ingredient?.price).reduce((sum, current) => sum + current.price, 0)\n        : 0,\n    [constructor]\n  );\n\n  const [{ isDrop }, dropTarget] = useDrop({\n    accept: \"ingredients\",\n    drop: (ingredient: any) => {\n      if (bun && ingredient.type === \"bun\") {\n        dispatch(deleteIngredient(bun?.uuid));\n      }\n      dispatch(addIngredient({ ...ingredient, uuid: uuidv4() }))\n    },\n    collect: (monitor) => ({\n      isDrop: monitor.isOver(),\n    }),\n  });\n\n  const clickOrder = () => {\n    if (loggedIn) {\n      const data = constructor.map(((item) => item._id));\n      console.log(data)\n      dispatch(getOrderID(data));\n      setTimeout(() => {\n        dispatch(openModalOrder())\n      }, 1000)\n    } else {\n      history.push(\"/login\");\n    }\n  }\n\n  const onClose = () => {\n    dispatch(closeModalOrder()); \n    console.log(open)\n    dispatch(resetOrder());\n  }\n\n  const classNameContainer = `${constructorStyles.container} ${isDrop && constructorStyles.drop}`\n\n  return (\n    <React.Fragment>\n      <Modal\n        isOpen={open}\n        onClose={onClose}\n      > <OrderDetails />\n      </Modal>\n      <div className={classNameContainer} ref={dropTarget}>\n        {\n          bun\n            ? <ConstructorElement\n              type=\"top\"\n              isLocked={true}\n              text={`${bun.name} (верх)`}\n              price={bun.price}\n              thumbnail={bun.image}\n            />\n            : <p className=\"text text_type_main-medium\" >\n              Перенесите сюда ингредиенты для бургера\n            </p>\n        }\n        <div className={constructorStyles.main}>\n          {other &&\n            other?.map((item, i) =>\n              (<Constructor key={item?.uuid} item={item} index={i} />))\n          }\n        </div>\n        {\n          bun\n          && <ConstructorElement\n            type=\"bottom\"\n            isLocked={true}\n            text={`${bun.name} (низ)`}\n            price={bun.price}\n            thumbnail={bun.image}\n          />\n        }\n        <div className={constructorStyles.cost}>\n          <div className={constructorStyles.price}>\n            <p className=\"text text_type_digits-medium\" >\n              {total}\n              <CurrencyIcon type=\"primary\" />\n            </p>\n          </div>\n          <Button type=\"primary\" size=\"large\" onClick={clickOrder} disabled={total === 0}>\n            Оформить заказ\n          </Button>\n        </div>\n      </div>\n    </React.Fragment>\n  )\n}\n\n\ntype TConstructor = {\n  item: TIngredient,\n  index: number,\n}\n\nexport default BurgerConstructor;"]},"metadata":{},"sourceType":"module"}